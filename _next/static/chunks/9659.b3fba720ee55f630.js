"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9659],{79659:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var r=i(74848),a=i(16286),n=i(96540);let l=i(33540).Ay.div.withConfig({componentId:"sc-16d5cff3-0"})(["#vimjs-canvas{image-rendering:pixelated;}#vimjs-container{height:100%;width:100%;}#vimjs-file{display:none;}#vimjs-font-test{position:absolute;visibility:hidden;}"]);var s=i(16602),o=i(8218),u=i(55650),c=i(41017),m=i(62104),d=i(48060),f=i(37e3),p=i(48287).Buffer;let w=({id:e})=>{let{closeWithTransition:t,processes:{[e]:i}}=(0,m.N)(),{readFile:w,updateFolder:h,writeFile:v}=(0,c.f)(),b=(0,s.A)(),{prependFileToTitle:$}=(0,u.A)(e),{libs:g=[],url:j=""}=i||{},[y,V]=(0,n.useState)([]),A=(0,n.useRef)(!1),M=(0,n.useCallback)(async()=>{let i=j||d.nB,[,...r]=i.split("/"),n="";1===r.length&&(n="/root"),window.VimWrapperModule={},await (0,f.aY)(g,!1,!!window.VimWrapperModule);let l=j?await w(i):p.from("");window.VimWrapperModule?.init?.({VIMJS_ALLOW_EXIT:!0,arguments:[`${n}${i}`],containerWindow:document.querySelector("#vimjs-container")?.closest("section"),memoryInitializerPrefixURL:"/Program Files/Vim.js/",postRun:[()=>{A.current=!1,b(window.VimWrapperModule?.VimModule?.FS,"Vim")}],preRun:[()=>{let e="";[n,...r].forEach((t,i,{[i+1]:a})=>{a&&i+1!==r.length?(window.VimWrapperModule?.VimModule?.FS_createPath?.(e,a,!0,!0),e+=`/${a}`):e?window.VimWrapperModule?.VimModule?.FS_createDataFile?.(e,t,l,!0,!0):e=t})}],print:console.info,printErr:console.info,quitCallback:()=>t(e),writeCallback:e=>V(t=>[...t,{buffer:p.from(e),url:i}])}),$((0,a.basename)(i))},[t,e,g,b,$,w,j]);return(0,n.useEffect)(()=>{y.length>0&&([...y].forEach(({buffer:e,url:t})=>{v(t,e,!0),h((0,a.dirname)(t),(0,a.basename)(t))}),V([]))},[h,y,v]),(0,n.useEffect)(()=>(A.current||(A.current=!0,M()),()=>{!A&&window.VimWrapperModule?.VimModule?.asmLibraryArg?._vimjs_prepare_exit()&&window.VimWrapperModule?.VimModule?.exit?.()}),[M]),(0,r.jsxs)(l,{children:[(0,r.jsx)("div",{id:"vimjs-container",...(0,o.A)({id:e}),children:(0,r.jsx)("canvas",{id:"vimjs-canvas",onContextMenuCapture:f.CH})}),(0,r.jsx)("div",{id:"vimjs-font-test"})]})}},16602:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(96540),a=i(41017);let n=()=>{let{mountEmscriptenFs:e,unMapFs:t,updateFolder:i}=(0,a.f)(),n=(0,r.useRef)();return(0,r.useEffect)(()=>()=>{if(n.current){let e=n.current;n.current="",t(e,!0).then(()=>i("/",void 0,e)).catch(()=>{})}},[t,i]),(0,r.useCallback)(async(t,r)=>{if(!t)return;let a="";try{a=await e(t,r)}catch{}a&&(i("/",a),n.current=a)},[e,i])}},8218:(e,t,i)=>{i.d(t,{A:()=>p});var r=i(16286),a=i(96540),n=i(51780),l=i(16091),s=i(13296),o=i(41017),u=i(62104),c=i(1364),m=i(48060),d=i(37e3),f=i(96119);let p=({callback:e,directory:t=m.Bn,id:i,onDragLeave:p,onDragOver:w,updatePositions:h})=>{let{url:v}=(0,u.N)(),b=(0,f.w)(),{iconPositions:$,sortOrders:g,setIconPositions:j}=(0,c.w)(),{exists:y,mkdirRecursive:V,updateFolder:A,writeFile:M}=(0,o.f)(),C=(0,a.useCallback)(async(e,t,a)=>{if(i){if(t){let n=(0,r.join)(m.Bn,e);if(await V(m.Bn),await M(n,t,!0))return a===s.z.UPDATE_URL&&v(i,n),A(m.Bn,e),(0,r.basename)(n)}else a===s.z.UPDATE_URL&&v(i,e)}return""},[i,V,A,v,M]),{openTransferDialog:_}=(0,n.A)();return{onDragLeave:p,onDragOver:e=>{w?.(e),(0,d.CH)(e)},onDrop:a=>{if(m.jj.has((0,d.uQ)(t)))return;if(h&&a.target instanceof HTMLElement){let{files:e,text:i}=(0,l.bn)(a);if(0===e.length&&""===i)return;(async()=>{let n={x:a.clientX,y:a.clientY},l=[];if(i){try{l=JSON.parse(i)}catch{}if(!Array.isArray(l))return;let[e]=l;if(!e||e.startsWith(t)&&(0,r.basename)(e)===(0,r.relative)(t,e))return;l=l.map(e=>(0,r.basename)(e))}else e instanceof FileList?l=[...e].map(e=>e.name):l=[...e].map(e=>e.getAsFile()?.name||"").filter(Boolean);l=await Promise.all(l.map(async e=>{let i=`${t}/${e}`;if(!$[i]||!await y(i))return e;let a=0;do a+=1,i=`${t}/${(0,r.basename)(e,(0,r.extname)(e))} (${a})${(0,r.extname)(e)}`;while($[i]&&await y(i));return(0,r.basename)(i)})),(0,d.$Y)(t,a.target,$,g,n,l,j,y)})()}let n="string"==typeof i;n&&!h&&t===m.Bn&&b.current[i]?.componentWindow?.focus(m.VD),(0,l.nX)(a,e||C,t,_,n)}}}},55650:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(96540),a=i(62104),n=i(25573),l=i(48060);let s=e=>{let{title:t}=(0,a.N)(),[i]=e.split(l.QB),{title:s}=n.A[i]||{};return{appendFileToTitle:(0,r.useCallback)((i,r)=>{let a=i?` - ${i}${r?` ${l.g6}`:""}`:"";t(e,`${s}${a}`)},[e,s,t]),prependFileToTitle:(0,r.useCallback)((i,r,a)=>{let n=i?`${r?`${l.g6} `:""}${i}${a?" ":" - "}`:"";t(e,`${n}${s}`)},[e,s,t])}}}}]);